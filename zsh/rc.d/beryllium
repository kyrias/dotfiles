# Inform the terminal of changes in CWD so that opening a new terminal in the same directory works.
function osc7 {
    local LC_ALL=C
    export LC_ALL

    setopt localoptions extendedglob
    input=( ${(s::)PWD} )
    uri=${(j::)input/(#b)([^A-Za-z0-9_.\!~*\'\(\)-\/])/%${(l:2::0:)$(([##16]#match))}}
    print -n "\e]7;file://${HOSTNAME}${uri}\e\\"
}
add-zsh-hook -Uz chpwd osc7

function ugit-crypt {
    (umask 077; git-crypt "$@")
}

eval "$(direnv hook zsh)"
